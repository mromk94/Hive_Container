<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Hive Connector</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root { --gold: #d4af37; --bg: #0a0a0a; --panel: #0f0f0f; --text: #f4f4f4; --muted:#9a9a9a; --danger:#e74c3c; --outline:#1f1f1f; }
      body { font-family: system-ui, sans-serif; padding:10px; width:340px; background: radial-gradient(1200px 600px at -20% -30%, rgba(212,175,55,0.08), transparent 60%), var(--bg); color: var(--text); }
      .popup-shell { border-radius:16px; border:1px solid #202020; background:linear-gradient(180deg,#121212,#0c0c0c); box-shadow: 0 18px 34px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03); padding:10px; }
      .topbar { display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
      .title { color: var(--gold); font-weight:700; letter-spacing:.3px; text-shadow:0 0 14px rgba(212,175,55,.22); }
      .window-buttons { display:flex; gap:6px; }
      .icon-btn { width:26px; height:26px; border-radius:8px; border:1px solid var(--outline); background:#151515; color:#ddd; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 10px 20px rgba(0,0,0,.25); }
      .icon-btn:hover { border-color: var(--gold); box-shadow:0 10px 22px rgba(212,175,55,.18); }
      h3 { color: var(--gold); margin: 4px 0 10px; letter-spacing: .3px; text-shadow: 0 0 18px rgba(212,175,55,.15); }
      h4 { color: var(--gold); margin: 8px 0 6px; font-weight: 600; }
      hr { border:0; border-top:1px solid #1a1a1a; margin:10px 0; }
      .session { border: 1px solid var(--outline); background: linear-gradient(180deg, #111, #0c0c0c); padding:10px; margin-bottom:10px; border-radius:10px; box-shadow: 0 12px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03); transform: translateZ(0); transition: transform .2s ease, box-shadow .2s ease, background .2s ease; }
      .session:hover { transform: translateY(-2px); box-shadow: 0 16px 28px rgba(0,0,0,.45), 0 0 0 1px rgba(212,175,55,.1) inset; }
      .btn { padding:8px 10px; border-radius:10px; cursor:pointer; background: linear-gradient(180deg, rgba(212,175,55,.18), rgba(212,175,55,.08)); color: var(--text); border:1px solid var(--gold); transition: transform .12s ease, box-shadow .12s ease, background .2s ease; box-shadow: 0 8px 18px rgba(212,175,55,.12); }
      .btn:hover { background: linear-gradient(180deg, rgba(212,175,55,.25), rgba(212,175,55,.12)); transform: translateY(-1px); box-shadow: 0 10px 22px rgba(212,175,55,.18); }
      .btn:active { transform: translateY(0); box-shadow: 0 4px 10px rgba(212,175,55,.12); }
      .approve { background: linear-gradient(180deg, var(--gold), #b6932b); color:#111; border-color: var(--gold); box-shadow: 0 10px 22px rgba(212,175,55,.25); }
      .approve:hover { filter: brightness(1.02); }
      .deny { background: linear-gradient(180deg, #ff6b6b, #d64a4a); color:#fff; border-color: #ff6b6b; margin-left:8px; box-shadow: 0 10px 22px rgba(255,107,107,.25); }
      input, select { width:100%; background:#0d0d0d; border:1px solid #1c1c1c; color: var(--text); padding:8px 10px; border-radius:8px; outline: none; transition: border-color .15s ease, box-shadow .15s ease; }
      input:focus, select:focus { border-color: var(--gold); box-shadow: 0 0 0 3px rgba(212,175,55,.12); }
      label { color: var(--muted); font-size: 12px; }
      .row { background: linear-gradient(180deg, #121212, #0f0f0f); border:1px solid var(--outline); border-radius:12px; padding:10px; margin:10px 0; box-shadow: 0 12px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03); }
      textarea { width:100%; background:#0d0d0d; border:1px solid #1c1c1c; color: var(--text); padding:8px 10px; border-radius:8px; outline: none; transition: border-color .15s ease, box-shadow .15s ease; min-height: 56px; resize: vertical; }
      textarea:focus { border-color: var(--gold); box-shadow: 0 0 0 3px rgba(212,175,55,.12); }
      .value { font-size:12px; color: var(--muted); margin-left:6px; }
      .tabs { display:flex; gap:8px; margin-bottom:8px; }
      .tabbtn { flex:1; padding:8px; border-radius:10px; border:1px solid var(--outline); background:#121212; color:var(--text); cursor:pointer; }
      .tabbtn.active { border-color: var(--gold); box-shadow: 0 0 0 2px rgba(212,175,55,.15) inset; }
      .chat-log { height: 280px; overflow:auto; border:1px solid var(--outline); border-radius:12px; padding:10px; background: linear-gradient(180deg, #131313, #0f0f0f); box-shadow: inset 0 1px 0 rgba(255,255,255,.03); }
      .msg { display:flex; gap:8px; margin:10px 0; align-items:flex-start; animation: fadeIn .18s ease both; }
      .msg.you { flex-direction: row-reverse; }
      .avatar { width:28px; height:28px; border-radius:50%; border:1px solid var(--outline); background:#0d0d0d; display:flex; align-items:center; justify-content:center; color:#ccc; font-size:12px; box-shadow:0 6px 16px rgba(0,0,0,.25); }
      .bubble { max-width: 78%; padding:8px 10px; border-radius:14px; border:1px solid var(--outline); background:#0f0f0f; box-shadow:0 10px 22px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.02); animation: popIn .16s ease both; }
      .you .bubble { background: linear-gradient(180deg, rgba(212,175,55,.16), rgba(212,175,55,.08)); border-color:#2a2415; }
      .who { font-size:10px; color: var(--muted); margin-bottom:4px; }
      @keyframes popIn { from { transform: scale(.98); opacity:.0;} to { transform: scale(1); opacity:1;} }
      @keyframes fadeIn { from { opacity:.0; } to { opacity:1; } }
      body.min #tab-chat .chat-log{ height: 90px; }
    </style>
  </head>
  <body>
    <div id="app" class="popup-shell">
    <div class="topbar">
      <div class="title">Hive</div>
      <div class="window-buttons">
        <button id="btn-min" class="icon-btn" title="Minimize">–</button>
        <button id="btn-close" class="icon-btn" title="Close">×</button>
      </div>
    </div>
    <div class="tabs">
      <button id="tabbtn-chat" class="tabbtn active">Chat</button>
      <button id="tabbtn-config" class="tabbtn">Config</button>
      <button id="tabbtn-profile" class="tabbtn">Profile</button>
    </div>
    <div id="tab-chat">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h3>Hive Chat</h3>
        <div class="value">Context: <span id="ctx-size">0</span></div>
      </div>
      <div id="chat-approval" class="row" style="display:none;">
        <!-- approval banner content injected by popup.ts -->
      </div>
      <div id="chat-log" class="chat-log" aria-live="polite"></div>
      <div style="display:flex; gap:6px; margin-top:8px;">
        <input id="chat-input" type="text" placeholder="Ask your AI..." />
        <button id="chat-send" class="btn">Send</button>
      </div>
    </div>
    <div id="tab-config" style="display:none;">
    <h3>Hive Connector</h3>
    <div id="session-list">No session requests</div>
    <hr/>
    <h4>User</h4>
    <div id="user-info">Not set</div>
    <button id="set-sample-user">Set sample user (dev)</button>
    <hr/>
    <h4>Persona</h4>
    <div>
      <label for="persona-name">Name</label><br/>
      <input id="persona-name" type="text" placeholder="My Hive" style="width:100%; margin:6px 0;" />
      <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
        <div style="flex:1;">
          <label for="persona-formality">Formality</label><span class="value" id="val-formality">50</span>
          <input id="persona-formality" type="range" min="0" max="100" value="50" />
        </div>
        <div style="flex:1;">
          <label for="persona-concision">Concision</label><span class="value" id="val-concision">50</span>
          <input id="persona-concision" type="range" min="0" max="100" value="50" />
        </div>
      </div>
      <label for="persona-keywords" style="margin-top:6px; display:block;">Voice keywords (comma-separated)</label>
      <textarea id="persona-keywords" placeholder="e.g. warm, direct, optimistic"></textarea>
      <label for="persona-bio" style="margin-top:6px; display:block;">Short bio</label>
      <textarea id="persona-bio" placeholder="Tell Hive how to introduce itself"></textarea>
      <label for="persona-rules" style="margin-top:6px; display:block;">Do / Don’t</label>
      <textarea id="persona-rules" placeholder="e.g. Do be concise. Don’t reveal secrets."></textarea>
      <div style="margin-top:8px;">
        <button id="save-persona" class="btn">Save Persona</button>
      </div>
    </div>
    <hr/>
    <h4>Choose AI Service</h4>
    <div>
      <label for="provider-select">Provider</label><br/>
      <select id="provider-select" style="width:100%; margin:6px 0;">
        <option value="openai">OpenAI</option>
        <option value="gemini">Gemini</option>
        <option value="claude">Claude</option>
        <option value="grok">Grok (base URL)</option>
        <option value="deepseek">DeepSeek</option>
        <option value="local">Local</option>
      </select>
      <label id="provider-token-label" for="provider-token">API Key</label><br/>
      <input id="provider-token" type="password" placeholder="Enter API key" style="width:100%; margin:6px 0;" />
      <div id="secure-status" style="font-size:12px; color: var(--muted); margin-bottom:6px;">Not saved</div>
      <div style="display:flex; align-items:center; gap:8px; margin:6px 0;">
        <input id="use-web-session" type="checkbox" />
        <label for="use-web-session">Use Web Session (if signed in on provider site)</label>
      </div>
      <div>
        <button id="save-token" class="btn">Save</button>
        <button id="clear-token" class="btn" style="margin-left:8px;">Clear</button>
      </div>
      <label for="provider-model">Preferred Model (optional)</label><br/>
      <input id="provider-model" type="text" placeholder="e.g. gemini-1.5-pro-latest" style="width:100%; margin:6px 0;" />
      <div>
        <button id="save-model" class="btn">Save Model</button>
        <button id="list-models" class="btn" style="margin-left:8px;">List Models</button>
      </div>
    </div>
    <div class="row">
      <h4>Sign in (optional)</h4>
      <div style="display:flex; flex-wrap:wrap; gap:6px;">
        <button id="oauth-openai" class="btn">OpenAI</button>
        <button id="oauth-gemini" class="btn">Gemini</button>
        <button id="oauth-claude" class="btn">Claude</button>
        <button id="oauth-grok" class="btn">Grok</button>
        <button id="oauth-deepseek" class="btn">DeepSeek</button>
      </div>
      <div class="value" style="margin-top:6px;">Uses provider login pages for now. API Keys still work.</div>
    </div>
    <div class="row">
      <h4>Google OAuth (Gemini)</h4>
      <label for="google-client-id">Client ID</label>
      <input id="google-client-id" placeholder="xxxxxxxxx-xxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com" />
      <label for="google-scopes" style="margin-top:6px; display:block;">Scopes</label>
      <input id="google-scopes" value="https://www.googleapis.com/auth/generative-language" />
      <div style="margin-top:6px;"><button id="save-google-oauth" class="btn">Save Google OAuth</button></div>
      <div class="value" style="margin-top:6px;">We store tokens encrypted locally.</div>
    </div>
    <div class="row">
      <h4>Sites & Shares</h4>
      <div id="consent-list">No sites have access yet.</div>
      <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
        <button id="refresh-consents" class="btn">Refresh Shares</button>
        <button id="grant-current" class="btn">Grant Current Tab (minimal)</button>
      </div>
      <div class="value" style="margin-top:6px;">View and revoke domains you've granted access. "Grant Current" adds the active tab's domain with minimal scopes.</div>
    </div>
    <hr/>
    <h4>Controls</h4>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <button id="revoke-last" class="btn deny">Revoke Last Session</button>
      <button id="debug-info" class="btn">Debug Info</button>
    </div>
    </div>
    <div id="tab-profile" style="display:none;">
      <h3>User Profile</h3>
      <div class="row">
        <label for="profile-personality">Personality</label>
        <textarea id="profile-personality" placeholder="Describe your personality, tone, quirks..."></textarea>
        <label for="profile-allergies" style="margin-top:6px; display:block;">Allergies (optional)</label>
        <input id="profile-allergies" placeholder="e.g. peanuts, shellfish" />
        <label for="profile-preferences" style="margin-top:6px; display:block;">Preferences</label>
        <textarea id="profile-preferences" placeholder="e.g. prefers concise responses, metric units"></textarea>
        <label for="profile-location" style="margin-top:6px; display:block;">Location (optional)</label>
        <input id="profile-location" placeholder="City, Country" />
        <label for="profile-interests" style="margin-top:6px; display:block;">Interests</label>
        <input id="profile-interests" placeholder="comma-separated" />
        <label for="profile-education" style="margin-top:6px; display:block;">Education</label>
        <input id="profile-education" placeholder="e.g. BSc Computer Science" />
        <label for="profile-socials" style="margin-top:6px; display:block;">Social handles</label>
        <textarea id="profile-socials" placeholder="@x_handle, linkedin.com/in/you ..."></textarea>
        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
          <button id="save-profile" class="btn">Save Profile</button>
          <button id="gen-signed-persona" class="btn">Generate Signed Persona</button>
          <button id="copy-public-key" class="btn">Copy Public Key</button>
        </div>
      </div>
      <div class="value">Stored encrypted locally. Shared with your AI for personalization.</div>
    </div>
    </div>
    <script src="popup.js"></script>
  </body>
</html>
